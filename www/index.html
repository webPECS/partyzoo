<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
<title>partyzoo_hu</title>
<link rel="stylesheet" href="partyzoo.css" />
<link rel="stylesheet" href="scripts/royalslider.css">
<script type="text/javascript" src="scripts/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="scripts/jquery.royalslider.min.js"></script>
<script type="text/javascript" src="phonegap.js"></script>

<style>
.royalSlider {
	width: 500px;
	height: 400px;
	position: relative;
	direction: ltr;
}

#kep-content {
	display:none;
	position:absolute;
	left:0;
	z-index:9000;
}

#partyzoo {
	margin:0 auto;
	padding:0;
	margin-top:0.75em;
}
.royalSlider img {
	border:1px solid #000000;
}

#proba {
	display:none; 
	position:absolute; 
	width:100%; 
	height:100%; 
	top:0; 
	left:0; 
	background-color:#000; 
	z-index:10000; 
	overflow:visible;
}

#kep-nav-wrap, #hatter-nav-wrap {
	padding-top:0.3em;
}

#proba img {
	width:100%;
}
</style>
</head>

<body>

<div id="proba" onclick="NagyKepKlikk();"> </div>

    <div id="kep-content">
      <div id="partyzoo" class="royalSlider">
      </div>
    </div>

<div id="wrap">

  <div id="head">
    <div class="styled-select">
      <select name="city" id="city">
        <option value="4" />Balaton</option>
        <option value="6" />Budapest</option>
        <option value="16" />Debrecen</option>
        <option value="7" />Győr</option>
        <option value="8" />Kaposvár</option>
        <option value="2" />Kecskemét</option>
        <option value="14" />Mosonmagyaróvár</option>
        <option value="1" />Pécs</option>
        <option value="9" />Sopron</option>
        <option value="13" />Szeged</option>
        <option value="19" />Székesfehérvár</option>
        <option value="11" />Szekszárd</option>
        <option value="15" />Veszprém</option>
        <option value="5" />Zalaegerszeg</option>
        <option value="0" />Minden város</option>
      </select>
    </div>
    <div class="search-form">
      KERESÉS
      <input type="text" name="search" id="search">
    </div>
  </div>

  <div id="loader">
  </div>

  <div id="index">
    <a href="javascript:Link('kepriport');">KÉPRIPORT</a>
    <a href="javascript:Link('program');">PROGRAM</a>
    <a href="javascript:Link('magazin');">MAGAZIN</a>
    <a href="javascript:Link('hir');">HÍR</a>
    <a href="javascript:Link('club');">CLUB</a>
    <a href="javascript:Link('hatterkep');">HÁTTÉRKÉP</a>
  </div>

  <div id="kepriport">
    <h1>KÉPRIPORT</h1>
    <div id="kepriport-content">
    </div>
  </div>

  <div id="program">
    <h1>PROGRAM</h1>
    <div id="program-content">
    </div>
  </div>

  <div id="magazin">
    <h1>MAGAZIN</h1>
    <div id="magazin-content">
    </div>
  </div>

  <div id="club">
    <h1>CLUB</h1>
    <div id="club-content">
    </div>
  </div>
  
  <div id="hir">
    <h1>HÍR</h1>
    <div id="hir-content">
    </div>
  </div>

  <div id="hatterkep">
    <h1>HÁTTÉRKÉP</h1>
    <div id="hatterkep-content">
    </div>
  </div>

  <div id="magazinkep">
  </div>

  <div id="clubkep">
  </div>
  
  <div id="kep">
    <div id="kep-nav-wrap">
      <div id="kep-nav"><a class="kep-nav-megosztas">MEGOSZTÁS</a><a class="kep-nav-mentes">MENTÉS</a></div>
    </div>
  </div>

  <div id="hatter">
    <div id="hatter-nav-wrap">
      <div id="hatter-nav"><a class="hatter-nav-megosztas">MEGOSZTÁS</a><a class="hatter-nav-mentes">MENTÉS</a></div>
    </div>
  </div>

  <div id="banner">
  </div>  

</div>
<script type="text/javascript">
   
function alertDismissed() { navigator.app.exitApp(); }

function doNothing() { }

function Uzenet(message) {
	navigator.notification.beep(1);
	navigator.notification.alert(message, function() {}, 'Partyzoo', 'ok');
}

function showAlert() {
	navigator.notification.beep(1);
	navigator.notification.alert('Internet kapcsolat szükséges!', alertDismissed, 'Partyzoo', 'Kilépés');
}

function PagePosition() {
	page_width = $(window).width();
	page_height = $(window).height();
	var link_height = page_width/6;
//	var head_height = link_height*1.8;
	var head_height = (page_height*0.18).toFixed();
	var form_height = page_width/12;
	var form_width = page_width/2;
	var link_margin = (link_height/10)/1;
	var link_fontsize = link_height/2.5;
	$('#head').css('height', head_height+'px');
	$('#kep-content').css('top', (page_height*0.23).toFixed() +'px');
	$('body').css('font-size', link_fontsize+'px');	
	$('#index a, h1, .rimg-row').css('margin-top', link_margin+'px');
	$('#index a, h1, .rimg-row').css('margin-bottom', link_margin+'px');
	$('#index img').css('margin-top', link_margin*2+'px');
	$('#index img').css('margin-bottom', link_margin*2+'px');
}

function Link(page,id,from,vissza,kategoria) {
	document.addEventListener("backbutton", BackToIndex, false);
	$(window).unbind('scroll');
	$('html, body').animate({ scrollTop: 0 }, 0);

	if (typeof from == 'undefined') { from = 0; }

	$('#'+current_page).fadeOut(200, function() {
		if (page=='index') {
			$('#loader').hide();
			$('#'+page).fadeIn(200);
		} else {
			if (id>0) { page_link = '_' + page; } else { page_link = ''; }
			if (page=='hatterkep') { 
				if (typeof kategoria == 'undefined') {
					kategoria = hatter_kategoria;
				} else { 
				    hatter_kategoria = kategoria;
				} 
			} else if (page=='magazin') {
				if (typeof kategoria == 'undefined') {
					kategoria = magazin_kategoria;
				} else { 
				    magazin_kategoria = kategoria;
				} 
			}
			$('#loader').show();
			$.ajax({
			  url: 'http://www.partyzoo.hu/android/ajax_13' + page_link + '.php',
			  data: { func: page, id: id, oldal: city, from: from, vissza: vissza, kategoria: kategoria, str_search: encodeURIComponent(str_search), erotika: erotika },
			  dataType: 'html',
			  success: function(data) {
				$('#loader').hide();
				
				if (page=='kep') {
					$('#banner').animate({bottom:'-100%',opacity:0.1},500);
					kep_adatok = data.split("+");
					$("#kep-content").html(kep_adatok[0]);
					window.kep_link = kep_adatok[2];
					window.kep_konyvtar = kep_adatok[3];
					window.kep_szam = parseInt(kep_adatok[1],10);
					SliderInit(kep_szam-1);
					$("#kep-content").show();
									
				} else if (page=='hatter') {
					$('#banner').animate({bottom:'-100%',opacity:0.1},500);
					kep_adatok = data.split("+");
					$("#kep-content").html(kep_adatok[0]);
					window.kep_meret1 = kep_adatok[2];
					window.kep_meret2 = kep_adatok[3];
					window.kep_szam = parseInt(kep_adatok[1],10);
					SliderInit();
					$("#kep-content").show();

				} else if (page=='magazinkep' || page=='clubkep') {
					$('#banner').animate({bottom:'-100%',opacity:0.1},500);
					kep_adatok = data.split("+");
					$("#kep-content").html(kep_adatok[0]);
					window.kep_szam = parseInt(kep_adatok[1],10);
					SliderInit(kep_szam-1);
					$("#kep-content").show();
										
				} else {

					$("#"+page+"-content").html(data);
				}
				$('#'+page).fadeIn(200);

				divek.forEach(function(entry) {
					if (entry!=page) {
						$("#"+entry+"-content").empty(); 
					}
				});
				
				if (vissza=='igen') {
					if (page=='kepriport' && id>0) {
						var pixel = (page_width/4.5) * (kep_szam/2);
						$('html, body').animate({scrollTop: '+='+pixel+'px'}, 500);
					} else {
						if (page=='magazin') vissza_szam++;
						var pixel = (page_width/5) * vissza_szam;
						$('html, body').animate({scrollTop: '+='+pixel+'px'}, 500);
					}
				}

			  }
			});
		}
		current_page = page;
		previous_id = current_id;
		if (ujfrom[page]!=0) { previous_from[page] = ujfrom[page]; }
		if (id>0) {	current_id = id; } else { current_id = 0; }
	});
}

function City() {
    city = $("#city").val();
	window.localStorage.setItem("city", city);
	Banner();
	if (current_page=='program' || current_page=='kepriport' || current_page=='club') {
		Link(current_page);
	}
}

function Search() {
    str_search = $("#search").val();
	if (current_page!='index' || current_page!='kep' || current_page!='hatter' || current_page!='clubkep' || current_page!='magazinkep') {
		Link(current_page);
	}
}

function endless_scroll(funk,id,oldal,str_search,darab,kategoria) {
    if($(window).scrollTop() > $(document).height() - $(window).height() - 100) {
		var loader_name = '#' + funk + '-loader';
		var content_name = '#' + funk + '-content';
		$(window).unbind('scroll');
		$(loader_name).show();
		ujfrom[funk] = ujfrom[funk] + darab;
		if (id>0) { page_link = '_' + funk; } else { page_link = ''; }
		$.ajax({
		  url: 'http://www.partyzoo.hu/android/ajax_13' + page_link + '.php',
		  data: { func: funk, id: id, oldal: oldal, kategoria: kategoria, from: ujfrom[funk], str_search: encodeURIComponent(str_search), erotika: erotika },
		  dataType: 'html',
		  success: function(data) {
			$(loader_name).hide();
			$(content_name).append(data);
            $(window).scroll(function() { endless_scroll(funk,id,oldal,str_search,darab,kategoria) } );
		  }
		});
	}
}

function Banner() {
	if ($('#banner').css('bottom') == '0px') {
		  $('#banner').animate({bottom:'-100%',opacity:0.1},1000);
	}
    //banner beolvasása
	$.ajax({
	  url: 'http://www.partyzoo.hu/android/ajax_banner.php',
	  data: { oldal: city },
	  dataType: 'html',
	  success: function(data) {
		  if (data!='') {
			  $("#banner").html(data);
			  $("#banner").animate({bottom:'0px',opacity:1.0},750);
		  }
	  }
	});
}

document.addEventListener("deviceready", onDeviceReady, false);

var current_page = 'index';
var current_id = 0;
var currentId = 0;
var previous_id = 0;
var previous_from = new Array();
var city = 0;
var str_search = '';
var hatter_kategoria = 998;
var magazin_kategoria = 999;
var page_width = 0;
var page_height = 0;
var vissza_szam = 0;
var ujfrom = new Array();
var erotika = 0;
var divek = ['kepriport', 'program', 'magazin', 'club', 'hir', 'hatterkep'];
//var watchID = null;


    function GpsPozicio(funkcio) {
		if (funkcio=='stop') {
			navigator.geolocation.clearWatch(watchID);
		} else {
//    	    watchID = navigator.geolocation.watchPosition(onSuccess, onError, options);
		}
	}

    function onSuccess(position) {
        alert = 'siker';
    }

    function onError(error) {
        alert('nemsiker');
    }	


function onDeviceReady() {
	
	//ablak átméretezése esetén is pozícióba állítás
	$(window).resize(PagePosition);

	//város beállítása és tárolása
	$("#city").change(City);
	if (typeof window.localStorage.getItem("city") != 'string') {
	    window.localStorage.setItem("city", city);
	} else {
	    city = window.localStorage.getItem("city");
	}
	$("#city").val(city);
	
	$("#search").change(Search);
	$("#search").val(str_search);
	
	function zeroPad(num, places) {
		var zero = places - num.toString().length + 1;
		return Array(+(zero > 0 && zero)).join("0") + num;
	}

	$(".kep-nav-mentes").on( "click", function() {
		var kep_fajlnev = 'kepriport_' + kep_konyvtar + '_' + kep_szam + '.jpg';
		var kep_url = 'http://www.partyzoo.hu/galeriak/' + kep_konyvtar + '/' + zeroPad(kep_szam,3) + '.jpg';
		FajlLetoltes(kep_fajlnev,kep_url);
	});

	$(".kep-nav-megosztas").on( "click", function() {
		var klink = 'http://www.partyzoo.hu/kep/' + kep_link + '/' + kep_szam;
		window.plugins.socialsharing.share(null, null, null, klink);
	});

	$(".hatter-nav-mentes").on( "click", function() {
		var kep_fajlnev = 'hatterkep_' + kep_szam + '_' + kep_meret1 + '_' + kep_meret2 + '.jpg';
		var kep_url = 'http://www.partyzoo.hu/hatterkep/'+kep_szam+'.jpg';
		FajlLetoltes(kep_fajlnev,kep_url);
	});
	
	$(".hatter-nav-megosztas").on( "click", function() {
		var klink = 'http://www.partyzoo.hu/hatterkep/'+kep_szam+'.jpg';
		window.plugins.socialsharing.share(null, null, klink, null);
	});
	
	
	//gombok méretének beállítása a képernyő méretéhez igazítva
	PagePosition();

	navigator.splashscreen.hide();
	
	//vissza gomb kezelése
	document.addEventListener("backbutton", BackToIndex, false);
	
	//internet kapcsolat figyelése
	if (navigator.network.connection.type == Connection.NONE){
		showAlert();
	} else {
		document.addEventListener("offline", showAlert, false);
	}
	
	Banner();
	
    var options = { timeout: 3000, maximumAge: 6000, enableHighAccuracy: true };
	navigator.geolocation.getCurrentPosition(onSuccess, onError, options);			

	
	$('#index').show();
}


function SliderInit(slid) {
	
  $('.royalSlider').css('width', page_width +'px');

  $(".royalSlider").royalSlider({
			numImagesToPreload: 4,
			navigateByClick: false,
			imageScaleMode: 'fit',
			imageScalePadding: 5,
			controlsInside: false,
			allowCSS3: true,
			startSlideId: slid,
			autoScaleSlider: true,
			autoScaleSliderWidth: page_width,
			autoScaleSliderHeight: (page_height*0.60).toFixed(),
            keyboardNavEnabled: true
        });

  window.slider = $(".royalSlider").data('royalSlider');
  
  slider.ev.on('rsAfterSlideChange', function(event) {
	var data = slider.currSlide.image;
    var start = data.lastIndexOf('/')+1;
    var end = data.lastIndexOf('.');
    if (end == -1) end = data.length();
    kep_szam = parseInt(data.substring(start , end),10);
  });  
  
  slider.ev.on('rsSlideClick', function(event, originalEvent) {
    $('#proba').html('<img src="'+ slider.currSlide.image +'" />');
	if (slider.currSlide.iW > slider.currSlide.iH) {
		window.plugins.orientationchanger.lockOrientation('landscape');
	} 
    currentId = slider.currSlideId;
	document.removeEventListener("backbutton", BackToIndex);	
	document.addEventListener("backbutton", NagyKepKlikk, false);
    $("#proba").show();
    $("#partyzoo").toggle();
	$("#wrap").toggle();
  });
	
}

function NagyKepKlikk() {
    window.plugins.orientationchanger.lockOrientation('portrait');
    $("#proba").hide();
	$("#wrap").show();
    $("#partyzoo").show();
    slider.goTo(currentId);
	document.removeEventListener("backbutton", NagyKepKlikk, false);
	document.addEventListener("backbutton", BackToIndex, false);
}

function BackToIndex(oldal) {
	document.removeEventListener("backbutton", BackToIndex);
	//vissza gombra kattintáskor az előző oldalra, kivéve, ha nyitóoldal
	if (current_page == 'index') {
		navigator.app.exitApp();
	} else {
		if (current_id!=0) {
			if (current_page=='club' || current_page=='magazin' || current_page=='program') {
				Link(current_page,0,ujfrom[current_page],'igen');
			} else if (current_page=='kepriport') {
				Link(current_page,0,previous_from[current_page],'igen');
			} else if (current_page=='kep') {
				$("#kep-content").hide();
				slider.destroy();
				Banner();
				Link('kepriport',previous_id,ujfrom['kepriport'],'igen');
			} else if (current_page=='hatter') {
				$("#kep-content").hide();
				slider.destroy();
				Banner();
				Link('hatterkep',previous_id);
			} else if (current_page=='magazinkep') {
				$("#kep-content").hide();
				slider.destroy();
				Banner();
				Link('magazin',previous_id);
			} else if (current_page=='clubkep') {
				$("#kep-content").hide();
				slider.destroy();
				Banner();
				Link('club',previous_id);
			} else {
				Link(current_page);
			}
		} else {
			Link('index');
		}
	}
	document.addEventListener("backbutton", BackToIndex, false);

}

function FajlLetoltes(fajlnev,url) {
	var localDir = "Partyzoo";
	var remoteFile = url;
	var localFileName = localDir + "/" + fajlnev;
	
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem) {
		fileSystem.root.getDirectory(localDir, {create: true, exclusive: false}, function() { 
        fileSystem.root.getFile(localFileName, {create: true, exclusive: false}, function(fileEntry) {
          var localPath = fileEntry.toURL();
//        var localPath = fileEntry.fullPath;
//             if (device.platform === "Android" && localPath.indexOf("file://") === 0) {
//                 localPath = localPath.substring(7);
//             }
							
            var ft = new FileTransfer();
            ft.download(remoteFile, localPath, function(entry) { Uzenet('A fájlt a Partyzoo mappába mentettem.'); }, function(error) { Uzenet('Hiba történt a fájl mentése közben: 1'+remoteFile+'-'+localFileName); }, true);
        }, function() { Uzenet('Hiba történt a fájl mentése közben: 2'+remoteFile+'-'+localFileName); });
    }, function() { Uzenet('Hiba történt a fájl mentése közben: 3'+remoteFile+'-'+localFileName); });
  }, function() { Uzenet('Hiba történt a fájl mentése közben: 4'+remoteFile+'-'+localFileName); });
}
  
</script>
</body>
</html>